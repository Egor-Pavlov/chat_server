# Back-end многопоточного чата
Проект является мини лабораторной работой по изучению многопоточности и взаимодействия с сетью
## Запуск
Для запуска приложения в IDE нужно отредактировать конфигурационный файл application.properties в /resources и запустить файл `configLoader.java`

Пример конфигурации:
```properties
server.port=12345
database.url=jdbc:mariadb://100.110.2.118:3306/chat
database.user=javauser
database.password=javapassword
history.size=10
```
Нужно указать путь к БД, логин и пароль пользователя БД с правами доступа, и количество старых сообщений, которые отправятся клиенту при подключении к серверу. 

## main.Main.java
Класс содержит подключение к порту, прослушивание и обработку входящих сообщений в отдельных потоках с помощью Threads
## main.ClientHandler.java
Наследуется от runnable для запуска в отдельном потоке, не возвращает результат работы. Обрабатывает полученные сообщения, записывает сообщения в БД в формате
```sql
MariaDB [chat]> select * from messages;
+----+-----------+------------------+---------------------+------------------+
| id | username  | message          | timestamp           | timezone         |
+----+-----------+------------------+---------------------+------------------+
|  1 | Admin     | привет           | 2021-06-23 01:45:29 | Europe/London    |
|  2 | anonymous | Проверка         | 2024-07-16 10:27:11 | Asia/Novosibirsk |
+----+-----------+------------------+---------------------+------------------+

```
При подключении нового клиента проверяется уникальность его имени пользователя, и если оно уникально - ему присылается история сообщений

Пример получаемого сообщения: `{"username":"anonymous","text":"Проверка","timestamp":"2024-07-16T10:27:11+07:00[Asia/Novosibirsk]"}`
Полученное сообщение рассылается всем подключенным клиентам. В бд запишется имя пользователя и текст
После записи в БД выполняется рассылка полученного сообщения клиентам. Клиентские приложения отображают сообщения на экране.

## Схема БД
При старте сервис создает таблицу messages. Для успешной инициализации таблицы БД и пользователь должны существовать и обладать корректными правами
Схема приложена в файле /src/schema.sql
```sql
CREATE TABLE messages (
                          id INT AUTO_INCREMENT PRIMARY KEY,
                          username VARCHAR(255) NOT NULL,
                          message TEXT NOT NULL,
                          timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                          timezone VARCHAR(50) DEFAULT NULL
);
```

## Клиентская часть описана в проекте chat_client 
https://github.com/Egor-Pavlov/chat_client
