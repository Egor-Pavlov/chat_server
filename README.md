# Back-end многопоточного чата
Проект является мини лабораторной работой по изучению многопоточности и взаимодействия с сетью
## Запуск
Для запуска приложения в IDE нужно отредактировать конфигурационный файл application.properties в /resources и запустить файл `configLoader.java`

Пример конфигурации:
```properties
server.port=12345
database.url=jdbc:mariadb://100.110.2.118:3306/chat
database.user=javauser
database.password=javapassword
history.size=10
```
Нужно указать путь к БД, логин и пароль пользователя БД с правами доступа, и количество старых сообщений, которые отправятся клиенту при подключении к серверу. 

## main.Main.java
Класс содержит подключение к порту, прослушивание и обработку входящих сообщений в отдельных потоках с помощью Threads
## main.ClientHandler.java
Наследуется от runnable для запуска в отдельном потоке, не возвращает результат работы. Обрабатывает полученные сообщения, записывает сообщения в БД в формате
```sql

MariaDB [chat]> select * from messages;
+----+-----------+----------+---------------------+
| id | username  | message  | timestamp           |
+----+-----------+----------+---------------------+
|  1 | user1     | test     | 2024-07-10 11:23:55 |
|  2 | anonymous | lernkege | 2024-07-10 11:27:17 |
|  3 | user2     | 1kdnbdk  | 2024-07-10 11:27:26 |
+----+-----------+----------+---------------------+
```
При подключении нового клиента проверяется уникальность его имени пользователя, и если оно уникально - ему присылается история сообщений

Пример получаемого сообщения: `user1|test`
Полученное сообщение рассылается всем подключенным клиентам. Если сообщение соответствует формату `<Имя пользователя>|<Текст>`, то в бд запишется имя пользователя, если сообщение содержит только текст, то будет записано имя пользователя "anonymous"
После записи в БД выполняется рассылка в формате `время|пользователь|текст`. Клиентские приложения отображают сообщения на экране.

## Схема БД
При старте сервис создает таблицу messages. Для успешной инициализации таблицы БД и пользователь должны существовать и обладать корректными правами
Схема приложена в файле /src/schema.sql
```sql
CREATE TABLE messages (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

```

## Клиентская часть описана в проекте chat_client 
https://github.com/Egor-Pavlov/chat_client
